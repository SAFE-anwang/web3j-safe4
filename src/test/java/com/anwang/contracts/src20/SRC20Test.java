package com.anwang.contracts.src20;

import com.anwang.src20.SRC20;
import org.bouncycastle.util.encoders.Hex;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.web3j.abi.datatypes.Address;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.http.HttpService;

import javax.xml.bind.DatatypeConverter;
import java.math.BigInteger;
import java.util.List;

public class SRC20Test {

    private Web3j web3j;
    private SRC20 src20;

    @BeforeEach
    public void init() {
        web3j = Web3j.build(new HttpService("http://127.0.0.1:8545"));
        src20 = new SRC20(web3j, 6666666);
    }

    @Test
    public void testDeploy() throws Exception {
        String name = "LMB100";
        String symbol = "LMB100";
        BigInteger totalSupply = new BigInteger("10000000000000000000000000000"); // 1B
        List<String> ret = src20.deploy("0x7b281a9ba16001feb62a5929526ef8f69d6550c6acdc3f0579c69199c0b6a010", name, symbol, totalSupply);
        System.out.println("contract address: " + ret.get(0));
        System.out.println("deploy txid: " + ret.get(1));
        Assertions.assertTrue(ret.get(0).length() != 0);
    }

    @Test
    public void testTransfer() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String txid = src20.transfer("0x7b281a9ba16001feb62a5929526ef8f69d6550c6acdc3f0579c69199c0b6a010", new Address("0x4c207825db1c46Dd836123E58ecaE85de7025879"), new BigInteger("100000000000000000000"));
        System.out.println(txid);
        Assertions.assertTrue(txid.length() != 0);
    }

    @Test
    public void testName() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String name = src20.name();
        System.out.println("name: " + name);
        Assertions.assertTrue(name.length() != 0);
    }

    @Test
    public void testSymbol() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String symbol = src20.symbol();
        System.out.println("symbol: " + symbol);
        Assertions.assertTrue(symbol.length() != 0);
    }

    @Test
    public void testDecimals() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        BigInteger decimals = src20.decimals();
        System.out.println("decimals: " + decimals);
        Assertions.assertEquals(18, decimals.intValue());
    }

    @Test
    public void testTotalSupply() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        BigInteger totalSupply = src20.totalSupply();
        System.out.println("totalSupply: " + totalSupply);
        Assertions.assertEquals(0, totalSupply.compareTo(new BigInteger("10000000000000000000000000000")));
    }

    @Test
    public void testOwner() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        Address owner = src20.owner();
        System.out.println("owner: " + owner);
        Assertions.assertEquals(Address.DEFAULT.getValue(), owner.getValue());
    }

    @Test
    public void testBalanceOf() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        BigInteger balance = src20.balanceOf(new Address("0x4c207825db1c46Dd836123E58ecaE85de7025879"));
        System.out.println("balance: " + balance);
        Assertions.assertEquals(0, balance.compareTo(new BigInteger("100000000000000000000")));
    }

    @Test
    public void testSetOrgName() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String txid = src20.setOrgName("0x7b281a9ba16001feb62a5929526ef8f69d6550c6acdc3f0579c69199c0b6a010", "lmb");
        System.out.println(txid);
        Assertions.assertTrue(txid.length() != 0);
    }

    @Test
    public void testSetLogo() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String hexLogo = "89504E470D0A1A0A0000000D4948445200000040000000400802000000250BE689000000017352474200AECE1CE9000000C2655849664D4D002A000000080007011200030000000100010000011A00050000000100000062011B0005000000010000006A0128000300000001000200000131000200000012000000720132000200000014000000848769000400000001000000980000000000000048000000010000004800000001506978656C6D61746F7220332E392E313000323032323A30363A31382032323A30363A3237000003A00100030000000100010000A00200040000000100000040A0030004000000010000004000000000D6C782EE000000097048597300000B1300000B1301009A9C18000003A969545874584D4C3A636F6D2E61646F62652E786D7000000000003C783A786D706D65746120786D6C6E733A783D2261646F62653A6E733A6D6574612F2220783A786D70746B3D22584D5020436F726520362E302E30223E0A2020203C7264663A52444620786D6C6E733A7264663D22687474703A2F2F7777772E77332E6F72672F313939392F30322F32322D7264662D73796E7461782D6E7323223E0A2020202020203C7264663A4465736372697074696F6E207264663A61626F75743D22220A202020202020202020202020786D6C6E733A746966663D22687474703A2F2F6E732E61646F62652E636F6D2F746966662F312E302F220A202020202020202020202020786D6C6E733A657869663D22687474703A2F2F6E732E61646F62652E636F6D2F657869662F312E302F220A202020202020202020202020786D6C6E733A786D703D22687474703A2F2F6E732E61646F62652E636F6D2F7861702F312E302F223E0A2020202020202020203C746966663A436F6D7072657373696F6E3E303C2F746966663A436F6D7072657373696F6E3E0A2020202020202020203C746966663A5265736F6C7574696F6E556E69743E323C2F746966663A5265736F6C7574696F6E556E69743E0A2020202020202020203C746966663A585265736F6C7574696F6E3E37323C2F746966663A585265736F6C7574696F6E3E0A2020202020202020203C746966663A595265736F6C7574696F6E3E37323C2F746966663A595265736F6C7574696F6E3E0A2020202020202020203C746966663A4F7269656E746174696F6E3E313C2F746966663A4F7269656E746174696F6E3E0A2020202020202020203C657869663A506978656C5844696D656E73696F6E3E36343C2F657869663A506978656C5844696D656E73696F6E3E0A2020202020202020203C657869663A436F6C6F7253706163653E313C2F657869663A436F6C6F7253706163653E0A2020202020202020203C657869663A506978656C5944696D656E73696F6E3E36343C2F657869663A506978656C5944696D656E73696F6E3E0A2020202020202020203C786D703A43726561746F72546F6F6C3E506978656C6D61746F7220332E392E31303C2F786D703A43726561746F72546F6F6C3E0A2020202020202020203C786D703A4D6F64696679446174653E323032322D30362D31385432323A30363A32373C2F786D703A4D6F64696679446174653E0A2020202020203C2F7264663A4465736372697074696F6E3E0A2020203C2F7264663A5244463E0A3C2F783A786D706D6574613E0ADBDC05360000054D494441546805ED59DB4F1C551C3EB3B3B75958AE62592ECBAD2D05165AC49AD418131F7C30266AE243539F343E3451E3258D49F5C1C4683131315A497CF48FF0D14463625B63A1B55084C242112C695916D8A5EC32B39719BFD95327C3B0343B33872524731E0EBF73CEEF9CF37DBFEF7766CE0EDC3F675F2487B9B80E337815BB43E0A01574147014B0190127856C06D0F6744701DB21B4B980A380CD00DA9EEE28603B84361738F40AB86D0680F3F9B9C6663958ED6E097B6AEBC5BB5179639D4FACC9B1FB36572E71BA2D02AEEA9AEAF317029153C4C5BB0A259FCF63636975E5E1E8D5CC955FE5C5F912715876E33F8C74599EACC87977E7F18AEE3E9EE7B108C7719486A73258D9DDE71B3A236E2695A5BB96D72F65A22D02449633B76F66384E381101744551B42D41C62D0482A79F9564253733A9F53337EC11001C45C94D4F643D5EE1782F3800372D1428EC40EF407AF95FF9DE2273E87441D3045CF54F12394FF2393DA0DCE45F59C2093DFD40ACD7013E60E56E3F9AFEF30A11D3FA29AC6C93048255F51787B9B6CEECC418F2470F42D5C1C5D35C7AA402C7C101368E443A999067FFD6FBB3B2CD11704506EB5E7A4D68EF521A421964B624E971E4A6C691F1C8197D276C70201ECFF6D83592CD1886EC37CDBDC87C5DDD4083ACA879EE85BA8F3E23750D0604722E87B01B14808F70AC47A97DC2E0CCA4698E00E17980439683039E9EB5EF7C4C74B0BCAF9C6D3CF716E0C381164084815AA55453C704B1611193040AB3350EC1BE93F51F7C4AEA551DBCAF9E0BBDF1B6FE410437F4D35AED1704C3DE4C9AE6DEC48A2421A2141305071D94F72EA6E7EE34BCFCFA6300E10D2D27365442AC8B3902D2FC8C2CCBF4BDABE546E58948B0A75FCB1903424A38BF9924EB71C31093A6B914529617736BAB7463BD0E1A1974EA0B3CD1449D7BB8C9E5B24C101B16314700514CFEFE0B5D8282D6079EDAFA1A9EB459D1D651F5E6BBC4CFFE189824A028DB3FFFB4B53047C30C7C9AA1D94515C068ED99E7ABCE5F60CEC1DC8B0C3888248A0B515FEF803B58A5364B2E2026B4B6294D6DD2F828C9324B27F3048078632D1D9DF67447BCD535252A0037E492CAA1B955696C5139303A129608143888B74625C2798E845C5E9F9E06062956AA0D8660E86BA125AC348525DCA658DC2CAC1200CAD4566E7C343D71736B79093708E2F16524319B4C24AF5F4D5EFBCDDBDAE12EBCB9F4D0A90D7AE0409AC399891B2463F776C4B1F91F99C7430A3A28B8A26EA721011779AAF1FD4FBC55D59A209A2C9A9118FB23F9C3D7249DA25A59ABAD2BB0633FE0463E209CDAE98CDD4FCDCFFAFB8778BF80C003F40EFF42433D0FE14EE9F60DC3AD76B7E7637A181128BAC3EA4A6A712170F269CA012E6082420D5A0BA166A5A55DBA75DDF279D84F02C0081DA277FCA74EF37E3F5A458B106A51C21DEA99CEECF87551D47977E73E13C0866BB1D4FC4C60F0197AA67723400F3870ED4745E8609EC3FE1300C0782C3537E31F1872072A0C298441DAE33F12226D5D199583B9E7525908500EB353C8257C6BA18835E85AD3DFD844DA8F8978B64A22464B2C26EF4225AE5ACC4D894EAF5C1E16576318A40F25AD86414B55FF20DF1D29367BCFBEF2115071CF4CC6BEBF24ADC70D8984262D526223BFB4B027D862036525A072800EDF7E21C656801851577B0A0586B8BE16FFEE4BF2E05E319C7BF6959B808A383A1D1B1916630FFE8FBBFA574A26E2235FE5CD7F843C00028F385CBE040E34B03818B16F3ECF4F4FEC19E7BD07CAF514DA8D0077F2D929826B693C96F871C4F2773B4697B9DDF8CAD5733029C4909D438061302D2DE52860296C0C27390A300CA6A5A51C052C858DE124470186C1B4B494A380A5B0319C74E815F80FE9671B64C9E69EEF0000000049454E44AE426082";
        byte[] logo = DatatypeConverter.parseHexBinary(hexLogo);
        BigInteger value = src20.getLogoPayAmount();
        String txid = src20.setLogo("0x7b281a9ba16001feb62a5929526ef8f69d6550c6acdc3f0579c69199c0b6a010", value, logo);
        System.out.println(txid);
        Assertions.assertTrue(txid.length() != 0);
    }

    @Test
    public void testSetDescription() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String txid = src20.setDescription("0x7b281a9ba16001feb62a5929526ef8f69d6550c6acdc3f0579c69199c0b6a010", "LMB100 is a test token");
        System.out.println(txid);
        Assertions.assertTrue(txid.length() != 0);
    }

    @Test
    public void testSetOfficialUrl() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String txid = src20.setOfficialUrl("0x7b281a9ba16001feb62a5929526ef8f69d6550c6acdc3f0579c69199c0b6a010", "https://www.lmb.com");
        System.out.println(txid);
        Assertions.assertTrue(txid.length() != 0);
    }

    @Test
    public void testSetWhitePaperUrl() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String txid = src20.setWhitePaperUrl("0x7b281a9ba16001feb62a5929526ef8f69d6550c6acdc3f0579c69199c0b6a010", "https://www.lmb.com/whitepaper.pdf");
        System.out.println(txid);
        Assertions.assertTrue(txid.length() != 0);
    }

    @Test
    public void testOrgName() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String orgName = src20.orgName();
        System.out.println("orgName: " + orgName);
        Assertions.assertTrue(orgName.length() != 0);
    }

    @Test
    public void testLogo() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        byte[] logo = src20.logo();
        System.out.println("logo: " + Hex.toHexString(logo));
        Assertions.assertTrue(logo.length != 0);
    }

    @Test
    public void testDescritpion() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String description = src20.description();
        System.out.println("description: " + description);
        Assertions.assertTrue(description.length() != 0);
    }

    @Test
    public void testOfficialUrl() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String officialUrl = src20.officialUrl();
        System.out.println("officialUrl: " + officialUrl);
        Assertions.assertTrue(officialUrl.length() != 0);
    }

    @Test
    public void testWhitePaperUrl() throws Exception {
        src20.load("0x005dff8772323b5c870c14461b2bee43d36f8786");
        String whitePaperUrl = src20.whitePaperUrl();
        System.out.println("whitePaperUrl: " + whitePaperUrl);
        Assertions.assertTrue(whitePaperUrl.length() != 0);
    }
}
